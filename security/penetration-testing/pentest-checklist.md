# Penetration Testing Checklist

## Rules of Engagement

### Scope
- **Target Environment**: Staging/Test only (NEVER production)
- **Applications**:
  - Web App: http://localhost:3000 (pzi-webapp)
  - API: http://localhost:8080 (pzi-api)
  - Auth Service: http://localhost:5000 (pzi-login)
- **Time Window**: Business hours (9 AM - 5 PM CET)
- **Contact**: DevOps team for incidents
- **Restrictions**: No DoS attacks, respect rate limits

### Data Handling
- Use only synthetic test data
- No production data access
- Secure storage of findings
- Delete artifacts after reporting

## Testing Methodology (OWASP Testing Guide)

### 1. Information Gathering
- [ ] Technology stack identification
- [ ] Application fingerprinting
- [ ] Error message analysis
- [ ] Directory/file enumeration
- [ ] API endpoint discovery
- [ ] Source code review (if available)

### 2. Authentication Testing
- [ ] Username enumeration
- [ ] Password policy testing
- [ ] Brute force protection
- [ ] Session management
- [ ] Multi-factor authentication bypass
- [ ] JWT token manipulation
- [ ] Auth0 flow security

**Tools**: Burp Suite, OWASP ZAP, Custom scripts
**Checklist**:
- [ ] Test default credentials
- [ ] Verify account lockout mechanisms
- [ ] Test session timeout
- [ ] Validate JWT signature verification
- [ ] Test token replay attacks
- [ ] Verify logout functionality

### 3. Authorization Testing
- [ ] Privilege escalation (horizontal/vertical)
- [ ] Insecure Direct Object References (IDOR)
- [ ] Role-based access control bypass
- [ ] Multi-tenant isolation
- [ ] Admin panel access
- [ ] API authorization

**Multi-tenancy Specific**:
- [ ] Cross-tenant data access
- [ ] Tenant ID manipulation
- [ ] Bulk operations across tenants
- [ ] Admin impersonation within tenant
- [ ] SuperAdmin role validation

### 4. Input Validation Testing
- [ ] SQL Injection
- [ ] Cross-Site Scripting (XSS)
- [ ] Command Injection
- [ ] Path Traversal
- [ ] File Upload vulnerabilities
- [ ] JSON/XML injection
- [ ] LDAP Injection

**Test Cases**:
```bash
# SQL Injection
' OR 1=1--
' UNION SELECT 1,2,3--
'; DROP TABLE users;--

# XSS
<script>alert('XSS')</script>
"><img src=x onerror=alert(1)>
javascript:alert(1)

# Command Injection
; cat /etc/passwd
| whoami
$(id)
```

### 5. Business Logic Testing
- [ ] Workflow bypass
- [ ] Price manipulation
- [ ] Quantity limits
- [ ] Race conditions
- [ ] Time-based attacks
- [ ] State manipulation

**Multi-tenant Business Logic**:
- [ ] Tenant creation/deletion workflows
- [ ] Billing/subscription bypass
- [ ] Resource quota enforcement
- [ ] Data export limitations
- [ ] Backup/restore procedures

### 6. API Security Testing (OWASP API Top 10)
- [ ] Broken Object Level Authorization
- [ ] Broken User Authentication
- [ ] Excessive Data Exposure
- [ ] Lack of Resources & Rate Limiting
- [ ] Broken Function Level Authorization
- [ ] Mass Assignment
- [ ] Security Misconfiguration
- [ ] Injection
- [ ] Improper Assets Management
- [ ] Insufficient Logging & Monitoring

**API Test Cases**:
```bash
# IDOR Testing
GET /api/users/1 -> GET /api/users/2
GET /api/tenants/123/records -> /api/tenants/456/records

# Mass Assignment
{"username": "test", "role": "admin"}
{"id": 1, "isAdmin": true}

# Rate Limiting
for i in {1..1000}; do curl -X POST /api/login; done
```

### 7. Web Application Security
- [ ] CSRF protection
- [ ] Clickjacking
- [ ] Content Security Policy
- [ ] HTTP Security Headers
- [ ] Cookie security
- [ ] CORS misconfiguration

### 8. Infrastructure Testing
- [ ] Network segmentation
- [ ] Container security
- [ ] Database access
- [ ] File permissions
- [ ] Environment variables
- [ ] Default configurations

## Automated Tools Integration

### SAST (Static Analysis)
```bash
# SonarQube
sonar-scanner -Dsonar.projectKey=animalia-claude

# CodeQL
codeql database analyze --format=json --output=results.json

# ESLint Security
eslint --ext .js,.jsx,.ts,.tsx --format json app/
```

### DAST (Dynamic Analysis)
```bash
# OWASP ZAP
python security/zap-baseline-scan.py http://localhost:3000

# Nikto
nikto -h localhost:3000

# SQLMap
sqlmap -u "http://localhost:8080/api/users" --batch --banner
```

### Container Security
```bash
# Trivy
trivy image pzi-api:latest

# Docker Bench
docker run --rm --net host --pid host --userns host --cap-add audit_control \
  -v /var/lib:/var/lib -v /var/run/docker.sock:/var/run/docker.sock \
  -v /usr/lib/systemd:/usr/lib/systemd docker/docker-bench-security
```

## Specific Attack Scenarios

### Scenario 1: Multi-tenant Data Breach
1. Register as tenant A user
2. Enumerate tenant B resources
3. Attempt to access tenant B data via API manipulation
4. Test bulk operations across tenants
5. Verify database-level isolation

### Scenario 2: Authentication Bypass
1. Analyze Auth0 integration
2. Test JWT token manipulation
3. Session fixation attacks
4. Password reset flow abuse
5. MFA bypass techniques

### Scenario 3: API Abuse
1. Discover hidden endpoints
2. Test rate limiting
3. Mass assignment attacks
4. Privilege escalation via API
5. Data exfiltration through APIs

### Scenario 4: Admin Panel Compromise
1. Locate admin interfaces
2. Test for default credentials
3. Brute force admin accounts
4. Privilege escalation to SuperAdmin
5. Tenant impersonation

## Reporting

### Vulnerability Classification
- **Critical**: Direct system compromise
- **High**: Significant security impact
- **Medium**: Potential security risk
- **Low**: Security improvement
- **Informational**: Best practice recommendation

### Report Sections
1. **Executive Summary**
   - Overall security posture
   - Critical findings summary
   - Risk assessment

2. **Technical Findings**
   - Detailed vulnerability descriptions
   - Proof of concept
   - CWE/OWASP mappings
   - Remediation steps

3. **Recommendations**
   - Immediate actions
   - Long-term improvements
   - Security controls

4. **Appendices**
   - Testing methodology
   - Tool outputs
   - Screenshots/evidence

## Remediation Tracking

### Process
1. Findings documented in security tracker
2. Assigned to development team
3. Fix verification testing
4. Security approval for closure
5. Trend analysis and lessons learned

### Metrics
- Time to remediation by severity
- Recurring vulnerability types
- Fix effectiveness
- Security debt tracking

## Compliance and Standards

### OWASP Compliance
- [ ] OWASP Top 10 coverage
- [ ] OWASP API Top 10 coverage
- [ ] OWASP Testing Guide methodology

### Industry Standards
- [ ] CWE classification
- [ ] CVE references where applicable
- [ ] GDPR privacy considerations
- [ ] SOC 2 Type II requirements